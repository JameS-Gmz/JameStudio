<div class="project-details-page" *ngIf="project && project.id">
    <div class="project-header">
        <h1 class="project-title">{{project?.title || translate('gameDetails.loading')}}</h1>
        
        <div class="project-carousel">
            <app-carousel [images]="images"></app-carousel>
        </div>
    </div>

    <div class="project-main-content">
        <div class="project-main-column">
            <section class="project-section description-section">
                <h2>{{ translate('projects.description') }}</h2>
                <div class="description-content">
                    <p>{{project?.description || translate('gameDetails.noDescription')}}</p>
                </div>
            </section>

            <section class="project-section technologies-section" *ngIf="project?.technologies && project.technologies.length > 0">
                <h2>{{ translate('projects.technologies') }}</h2>
                <div class="tech-tags">
                    <span *ngFor="let tech of project.technologies" class="tech-tag">{{tech}}</span>
                </div>
            </section>

            <section class="project-section links-section" *ngIf="project?.github || project?.demo">
                <h2>{{ translate('projects.links') }}</h2>
                <div class="project-links">
                    <a *ngIf="project.github" [href]="project.github" target="_blank" rel="noopener noreferrer" class="link-button github-link">
                        <i class="fab fa-github"></i>
                        <span>{{ translate('projects.viewGitHub') }}</span>
                    </a>
                    <a *ngIf="project.demo" [href]="project.demo" target="_blank" rel="noopener noreferrer" class="link-button demo-link">
                        <i class="fas fa-external-link-alt"></i>
                        <span>{{ translate('projects.viewDemo') }}</span>
                    </a>
                </div>
            </section>
        </div>

        <div class="project-sidebar">
            <section class="sidebar-section rating-section" *ngIf="averageRating > 0 || totalRatings > 0">
                <h3>{{ translate('comments.averageRating') }}</h3>
                <div class="rating-display">
                    <div class="rating-value">{{averageRating > 0 ? averageRating.toFixed(1) : 'N/A'}}<span class="rating-max">/5</span></div>
                    <div class="rating-count">{{totalRatings}} {{totalRatings > 1 ? translate('comments.ratings') : translate('comments.ratingSingle')}}</div>
                </div>
            </section>

            <section class="sidebar-section actions-section">
                <h3>{{ translate('gameDetails.actions') }}</h3>
                <button 
                    class="action-button library-button" 
                    [class.in-library]="isInLibrary"
                    [disabled]="loading"
                    (click)="toggleLibrary()">
                    <i class="fas" [class.fa-bookmark]="!isInLibrary" [class.fa-bookmark-slash]="isInLibrary"></i>
                    <span>{{isInLibrary ? translate('library.removeFromLibrary') : translate('library.addToLibrary')}}</span>
                    <span *ngIf="loading" class="loading-spinner-small"></span>
                </button>
            </section>

            <section class="sidebar-section metadata-section">
                <h3>{{ translate('gameDetails.information') }}</h3>
                <div class="metadata-list">
                    <div class="metadata-item" *ngIf="project?.authorStudio">
                        <span class="metadata-label">{{ translate('projects.author') }}</span>
                        <span class="metadata-value">{{project.authorStudio}}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">{{ translate('projects.lastUpdate') }}</span>
                        <span class="metadata-value">{{project?.updatedAt ? (project.updatedAt | date:'mediumDate') : translate('projects.notSpecified')}}</span>
                    </div>
                    <div class="metadata-item">
                        <span class="metadata-label">{{ translate('projects.createdAt') }}</span>
                        <span class="metadata-value">{{project?.createdAt ? (project.createdAt | date:'mediumDate') : translate('projects.notSpecified')}}</span>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <div class="comments-section">
        <section class="project-section comment-form-section">
            <h2 *ngIf="!currentUserComment">{{ translate('comments.leaveReview') }}</h2>
            <h2 *ngIf="currentUserComment">{{ translate('comments.editReview') }}</h2>
            
            <div class="comment-identity-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="comment-email">
                            {{ translate('comments.email') }} <span class="required">*</span>
                        </label>
                        <input 
                            type="email" 
                            id="comment-email"
                            [(ngModel)]="commentEmail"
                            placeholder="votre@email.com"
                            class="comment-input"
                            [disabled]="isSubmitting"
                            required
                        />
                        <p class="form-hint">{{ translate('comments.emailHint') }}</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="comment-name">
                            {{ translate('comments.name') }}
                        </label>
                        <input 
                            type="text" 
                            id="comment-name"
                            [(ngModel)]="commentAuthorName"
                            [placeholder]="translate('comments.namePlaceholder')"
                            class="comment-input"
                            [disabled]="isSubmitting"
                        />
                    </div>
                </div>
            </div>
            
            <div class="rating-input-section">
                <label>{{ translate('comments.rating') }}</label>
                <app-rating-component 
                    [rating]="commentRating"
                    [readonly]="false"
                    (ratingChange)="onRatingChange($event)">
                </app-rating-component>
            </div>
            
            <div class="comment-section">
                <label for="comment-content">{{ translate('comments.comment') }}</label>
                <textarea 
                    id="comment-content"
                    [(ngModel)]="commentContent"
                    [placeholder]="translate('comments.commentPlaceholder')" 
                    rows="4" 
                    class="review-textarea"
                    [disabled]="isSubmitting">
                </textarea>
                
                <div class="error-message" *ngIf="errorMessage">
                    <i class="fas fa-exclamation-circle"></i>
                    {{ errorMessage }}
                </div>
                
                <div class="comment-actions">
                    <button 
                        class="submit-review" 
                        (click)="submitComment()"
                        [disabled]="isSubmitting">
                        <i class="fas" [class.fa-paper-plane]="!isSubmitting" [class.fa-spinner]="isSubmitting" [class.fa-spin]="isSubmitting"></i>
                        <span *ngIf="!isSubmitting">{{ currentUserComment ? translate('comments.edit') : translate('comments.publish') }}</span>
                        <span *ngIf="isSubmitting">{{ translate('comments.publishing') }}</span>
                    </button>
                    
                    <button 
                        *ngIf="currentUserComment && !showDeleteConfirm"
                        class="delete-review" 
                        (click)="requestDeleteComment(currentUserComment!.id)"
                        [disabled]="isSubmitting">
                        <i class="fas fa-trash"></i>
                        {{ translate('comments.delete') }}
                    </button>
                    
                    <div *ngIf="showDeleteConfirm" class="delete-confirmation">
                        <p>{{ translate('comments.deleteConfirm') }}</p>
                        <div class="confirmation-actions">
                            <button class="confirm-button" (click)="confirmDeleteComment()" [disabled]="isSubmitting">
                                <i class="fas fa-check"></i>
                                {{ translate('common.yes') }}
                            </button>
                            <button class="cancel-button" (click)="cancelDeleteComment()" [disabled]="isSubmitting">
                                <i class="fas fa-times"></i>
                                {{ translate('common.no') }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="project-section comments-list-section">
            <div class="section-header">
                <h2>{{ translate('comments.title') }}</h2>
                <div class="comments-stats">
                    <span class="comments-count">{{ totalComments }} {{ totalComments > 1 ? translate('comments.count') : translate('comments.countSingle') }}</span>
                    <span class="average-rating" *ngIf="averageRating > 0">
                        <i class="fas fa-star"></i>
                        {{ averageRating.toFixed(1) }}/5
                    </span>
                </div>
            </div>
            
            <div class="comments-list" *ngIf="comments.length > 0">
                <div class="comment-item" *ngFor="let comment of comments">
                    <div class="comment-header">
                        <div class="comment-user">
                            <div class="user-info">
                                <span class="username">{{ comment.authorName }}</span>
                                <span class="user-email-hint" *ngIf="userEmail && comment.email.toLowerCase() === userEmail.toLowerCase()">{{ translate('comments.you') }}</span>
                            </div>
                        </div>
                        <div class="comment-meta">
                            <app-rating-component 
                                [rating]="comment.rating || 0"
                                [readonly]="true">
                            </app-rating-component>
                            <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
                        </div>
                    </div>
                    
                    <div class="comment-content" *ngIf="comment.content">
                        <p>{{ comment.content }}</p>
                    </div>
                    
                    <div class="comment-footer" *ngIf="comment.rating && !comment.content">
                        <p class="rating-only">{{ translate('comments.ratingOnly') }} ({{ comment.rating }}/5)</p>
                    </div>
                </div>
            </div>
            
            <div class="no-comments" *ngIf="comments.length === 0">
                <i class="fas fa-comments"></i>
                <p>{{ translate('comments.noComments') }}</p>
            </div>
        </section>
    </div>
</div>

<div class="loading-state" *ngIf="!project || !project.id">
    <div class="spinner-large"></div>
    <p>{{ translate('gameDetails.loadingProject') }}</p>
</div>
